!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).TweakpaneFileImportPlugin={})}(this,(function(t){"use strict";class e{constructor(){this.observers_={}}on(t,e){let n=this.observers_[t];return n||(n=this.observers_[t]=[]),n.push({handler:e}),this}off(t,e){const n=this.observers_[t];return n&&(this.observers_[t]=n.filter((t=>t.handler!==e))),this}emit(t,e){const n=this.observers_[t];n&&n.forEach((t=>{t.handler(e)}))}}const n="tp";function i(t){return(e,i)=>[n,"-",t,"v",e?`_${e}`:"",i?`-${i}`:""].join("")}function o(t){return e=>n=>{if(!e&&void 0===n)return{succeeded:!1,value:void 0};if(e&&void 0===n)return{succeeded:!0,value:void 0};const i=t(n);return void 0!==i?{succeeded:!0,value:i}:{succeeded:!1,value:void 0}}}function s(t){return{custom:e=>o(e)(t),boolean:o((t=>"boolean"==typeof t?t:void 0))(t),number:o((t=>"number"==typeof t?t:void 0))(t),string:o((t=>"string"==typeof t?t:void 0))(t),function:o((t=>"function"==typeof t?t:void 0))(t),constant:e=>o((t=>t===e?e:void 0))(t),raw:o((t=>t))(t),object:e=>o((t=>{var n;if(null!==(n=t)&&"object"==typeof n)return function(t,e){return Object.keys(e).reduce(((n,i)=>{if(void 0===n)return;const o=(0,e[i])(t[i]);return o.succeeded?Object.assign(Object.assign({},n),{[i]:o.value}):void 0}),{})}(t,e)}))(t),array:e=>o((t=>{var n;if(Array.isArray(t))return n=e,t.reduce(((t,e)=>{if(void 0===t)return;const i=n(e);return i.succeeded&&void 0!==i.value?[...t,i.value]:void 0}),[])}))(t)}}const r={optional:s(!0),required:s(!1)};class a{constructor(t){this.constraints=t}constrain(t){return this.constraints.reduce(((t,e)=>e.constrain(t)),t)}}function l(t){return e=>e.toFixed(Math.max(Math.min(t,20),0))}l(0);function c(t,e){var n,i;const o=e.ownerDocument.defaultView,s=e.getBoundingClientRect();return{x:t.pageX-((null!==(n=o&&o.scrollX)&&void 0!==n?n:0)+s.left),y:t.pageY-((null!==(i=o&&o.scrollY)&&void 0!==i?i:0)+s.top)}}class u{constructor(t){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=t,this.emitter=new e,t.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),t.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),t.addEventListener("touchend",this.onTouchEnd_),t.addEventListener("mousedown",this.onMouseDown_)}computePosition_(t){const e=this.elem_.getBoundingClientRect();return{bounds:{width:e.width,height:e.height},point:t?{x:t.x,y:t.y}:null}}onMouseDown_(t){var e;t.preventDefault(),null===(e=t.currentTarget)||void 0===e||e.focus();const n=this.elem_.ownerDocument;n.addEventListener("mousemove",this.onDocumentMouseMove_),n.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(c(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseMove_(t){this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(c(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onDocumentMouseUp_(t){const e=this.elem_.ownerDocument;e.removeEventListener("mousemove",this.onDocumentMouseMove_),e.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(c(t,this.elem_)),sender:this,shiftKey:t.shiftKey})}onTouchStart_(t){t.preventDefault();const e=t.targetTouches.item(0),n=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:t.altKey,data:this.computePosition_(e?{x:e.clientX-n.left,y:e.clientY-n.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=e}onTouchMove_(t){const e=t.targetTouches.item(0),n=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:t.altKey,data:this.computePosition_(e?{x:e.clientX-n.left,y:e.clientY-n.top}:void 0),sender:this,shiftKey:t.shiftKey}),this.lastTouch_=e}onTouchEnd_(t){var e;const n=null!==(e=t.targetTouches.item(0))&&void 0!==e?e:this.lastTouch_,i=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:t.altKey,data:this.computePosition_(n?{x:n.clientX-i.left,y:n.clientY-i.top}:void 0),sender:this,shiftKey:t.shiftKey})}}function h(t){return[t[0],t[1],t[2]]}function d(t){return e=>function(t,e){const n=l("float"===e?2:0);return`rgb(${h(t.getComponents("rgb",e)).map((t=>n(t))).join(", ")})`}(e,t)}function p(t){return e=>function(t,e){const n=l(2),i=l("float"===e?2:0);return`rgba(${t.getComponents("rgb",e).map(((t,e)=>(3===e?n:i)(t))).join(", ")})`}(e,t)}function v(t){return e=>function(t,e){const n=l("float"===e?2:0),i=["r","g","b"];return`{${h(t.getComponents("rgb",e)).map(((t,e)=>`${i[e]}: ${n(t)}`)).join(", ")}}`}(e,t)}function f(t){return e=>function(t,e){const n=l(2),i=l("float"===e?2:0),o=["r","g","b","a"];return`{${t.getComponents("rgb",e).map(((t,e)=>`${o[e]}: ${(3===e?n:i)(t)}`)).join(", ")}}`}(e,t)}["int","float"].reduce(((t,e)=>[...t,{format:{alpha:!1,mode:"rgb",notation:"func",type:e},stringifier:d(e)},{format:{alpha:!0,mode:"rgb",notation:"func",type:e},stringifier:p(e)},{format:{alpha:!1,mode:"rgb",notation:"object",type:e},stringifier:v(e)},{format:{alpha:!0,mode:"rgb",notation:"object",type:e},stringifier:f(e)}]),[]);const m=i("ctn"),b=i("btn");class g{constructor(t,e){this.onDrop_=this.onDrop_.bind(this),this.element=t.createElement("div"),this.container=t.createElement("div"),this.container.style.height=`calc(var(--bld-us) * ${e.lineCount})`,this.container.classList.add(m()),this.element.appendChild(this.container),this.fileIconEl_=t.createElement("div"),this.fileIconEl_.classList.add(m("icon")),this.container.appendChild(this.fileIconEl_),this.textEl_=t.createElement("span"),this.textEl_.classList.add(m("text")),this.button=t.createElement("button"),this.button.classList.add(b("b")),this.button.innerHTML="Delete",this.button.style.display="none",this.element.appendChild(this.button),this.element.addEventListener("drop",this.onDrop_),this.element.addEventListener("dragover",this.onDragOver_),this.value_=e.value,this.value_.emitter.on("change",this.onValueChange_.bind(this)),e.viewProps.bindClassModifiers(this.element),e.viewProps.handleDispose((()=>{console.log("TODO: dispose view")}))}onDragOver_(t){t.preventDefault()}onDrop_(t){if(t instanceof DragEvent&&(t.preventDefault(),t.dataTransfer&&t.dataTransfer.files)){const e=t.dataTransfer.files;if(1==e.length){const t=e.item(0);this.value_.setRawValue(t)}}}onValueChange_(){const t=this.value_.rawValue;t?(this.textEl_.textContent=t.name,this.container.appendChild(this.textEl_),this.container.contains(this.fileIconEl_)&&this.container.removeChild(this.fileIconEl_),this.button.style.display="block",this.container.style.border="unset"):(this.textEl_.textContent="",this.container.appendChild(this.fileIconEl_),this.container.removeChild(this.textEl_),this.button.style.display="none",this.container.style.border="1px dashed #717070")}}class _{constructor(t,e){this.onContainerClick_=this.onContainerClick_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.value=e.value,this.filetypes=e.filetypes,this.viewProps=e.viewProps,this.viewProps.handleDispose((()=>{})),this.view=new g(t,{value:this.value,viewProps:this.viewProps,lineCount:e.lineCount});new u(this.view.container).emitter.on("down",this.onContainerClick_);new u(this.view.button).emitter.on("down",this.onButtonClick_)}onContainerClick_(t){const e=this.filetypes,n=document.createElement("input");n.setAttribute("type","file"),n.style.opacity="0",n.style.position="fixed",n.style.pointerEvents="none",document.body.appendChild(n),n.addEventListener("input",(t=>{var i;if(n.files&&n.files.length>0){const t=n.files[0],o="."+(null===(i=t.name.split(".").pop())||void 0===i?void 0:i.toLowerCase());if(e&&e.length>0&&!e.includes(o)&&o)return;this.value.setRawValue(t)}}),{once:!0}),n.click(),document.body.removeChild(n)}onButtonClick_(t){this.value.rawValue&&this.value.setRawValue(null)}}const y=[{id:"file-input",type:"input",css:'.tp-ctnv{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:rgba(0,0,0,0);border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-ctnv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-ctnv:hover{background-color:var(--in-bg-h)}.tp-ctnv:focus{background-color:var(--in-bg-f)}.tp-ctnv:active{background-color:var(--in-bg-a)}.tp-ctnv:disabled{opacity:.5}.tp-ctnv{cursor:pointer;display:flex;justify-content:center;align-items:center;overflow:hidden;position:relative;border:1px dashed #717070;border-radius:5px}.tp-ctnv.tp-v-disabled{opacity:.5}.tp-ctnv_text{color:var(--in-fg);bottom:2px;display:inline-block;font-size:.9em;height:-moz-max-content;height:max-content;line-height:.9;margin:.2rem;max-height:100%;max-width:100%;opacity:.5;position:absolute;right:2px;text-align:right;white-space:normal;width:-moz-max-content;width:max-content;word-wrap:break-word}.tp-ctnv_frac{background-color:var(--in-fg);border-radius:1px;height:2px;left:50%;margin-top:-1px;position:absolute;top:50%}.tp-ctnv_icon{box-sizing:border-box;position:relative;display:block;transform:scale(var(--ggs, 1));width:16px;height:6px;border:2px solid;border-top:0;border-bottom-left-radius:2px;border-bottom-right-radius:2px;margin-top:8px;opacity:.5}.tp-ctnv_icon::after{content:"";display:block;box-sizing:border-box;position:absolute;width:8px;height:8px;border-left:2px solid;border-top:2px solid;transform:rotate(45deg);left:2px;bottom:4px}.tp-ctnv_icon::before{content:"";display:block;box-sizing:border-box;position:absolute;border-radius:3px;width:2px;height:10px;background:currentColor;left:5px;bottom:3px}.tp-btnv_b{margin-top:10px}',accept(t,e){if("string"!=typeof t)return null;const n=r,i=function(t,e){const n=r.required.object(e)(t);return n.succeeded?n.value:void 0}(e,{view:n.required.constant("file-input"),lineCount:n.optional.number,filetypes:n.optional.array(n.required.string)});return i?{initialValue:t,params:i}:null},binding:{reader:t=>t=>t instanceof File?t:null,constraint:t=>new a([]),writer:t=>(t,e)=>{t.write(e)}},controller(t){var e;return new _(t.document,{value:t.value,viewProps:t.viewProps,lineCount:null!==(e=t.params.lineCount)&&void 0!==e?e:3,filetypes:t.params.filetypes})}}];t.plugins=y,Object.defineProperty(t,"__esModule",{value:!0})}));
